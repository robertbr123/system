<script type="text/javascript">
        var gk_isXlsx = false;
        var gk_xlsxFileLookup = {};
        var gk_fileData = {};
        function filledCell(cell) {
          return cell !== '' && cell != null;
        }
        function loadFileData(filename) {
        if (gk_isXlsx && gk_xlsxFileLookup[filename]) {
            try {
                var workbook = XLSX.read(gk_fileData[filename], { type: 'base64' });
                var firstSheetName = workbook.SheetNames[0];
                var worksheet = workbook.Sheets[firstSheetName];

                // Convert sheet to JSON to filter blank rows
                var jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1, blankrows: false, defval: '' });
                // Filter out blank rows (rows where all cells are empty, null, or undefined)
                var filteredData = jsonData.filter(row => row.some(filledCell));

                // Heuristic to find the header row by ignoring rows with fewer filled cells than the next row
                var headerRowIndex = filteredData.findIndex((row, index) =>
                  row.filter(filledCell).length >= filteredData[index + 1]?.filter(filledCell).length
                );
                // Fallback
                if (headerRowIndex === -1 || headerRowIndex > 25) {
                  headerRowIndex = 0;
                }

                // Convert filtered JSON back to CSV
                var csv = XLSX.utils.aoa_to_sheet(filteredData.slice(headerRowIndex)); // Create a new sheet from filtered array of arrays
                csv = XLSX.utils.sheet_to_csv(csv, { header: 1 });
                return csv;
            } catch (e) {
                console.error(e);
                return "";
            }
        }
        return gk_fileData[filename] || "";
        }
        </script><!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Leitor de CÃ³digos - Sistema ERP</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/quagga@0.12.1/dist/quagga.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jsqr@1.4.0/dist/jsQR.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
    }
    .gradient-header {
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }
    .nav-link {
      position: relative;
      transition: color 0.3s ease;
    }
    .nav-link::after {
      content: '';
      position: absolute;
      width: 0;
      height: 2px;
      bottom: -2px;
      left: 0;
      background-color: #ffffff;
      transition: width 0.3s ease;
    }
    .nav-link:hover::after {
      width: 100%;
    }
    .card {
      transition: all 0.3s ease;
      border-radius: 20px;
      background: rgba(255, 255, 255, 0.95);
      animation: fadeIn 0.5s ease-out;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.2);
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
    }
    .card:hover {
      transform: translateY(-4px);
      box-shadow: 0 15px 40px rgba(0, 0, 0, 0.2);
      border: 1px solid rgba(255, 255, 255, 0.4);
    }
    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    .btn-primary {
      transition: transform 0.2s, background-color 0.2s, box-shadow 0.2s, filter 0.2s;
      border-radius: 8px;
      display: flex;
      align-items: center;
      gap: 8px;
      font-weight: 500;
      padding: 0.75rem 1.5rem;
    }
    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
      filter: brightness(1.1);
    }
    .btn-scanning .fa-camera {
      animation: spin 2s linear infinite;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    .modal {
      transition: opacity 0.3s ease-in-out, transform 0.3s ease-in-out;
      transform: scale(0.95);
      opacity: 0;
    }
    .modal.show {
      transform: scale(1);
      opacity: 1;
    }
    #scanner-container {
      position: relative;
      width: 100%;
      max-width: 640px;
      margin: 0 auto;
      border: 2px solid rgba(102, 126, 234, 0.3);
      border-radius: 20px;
      overflow: hidden;
      box-shadow: 0 10px 30px rgba(102, 126, 234, 0.2);
      transition: all 0.3s ease;
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
    }
    #scanner-container:hover {
      transform: scale(1.01);
      box-shadow: 0 15px 40px rgba(102, 126, 234, 0.3);
      border-color: rgba(102, 126, 234, 0.5);
    }
    #scanner-container video {
      width: 100%;
      height: auto;
      transform: scale(1.02);
      transition: transform 0.3s ease;
    }
    #scanner-overlay {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      border: 20px solid rgba(0, 0, 0, 0.5);
      box-sizing: border-box;
      pointer-events: none;
    }
    #scanner-overlay::before {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 60%;
      height: 60%;
      border: 2px solid #10b981;
      border-radius: 8px;
      transform: translate(-50%, -50%);
      animation: pulse 1.5s ease-in-out infinite;
    }
    @keyframes pulse {
      0% { border-color: #10b981; box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.7); }
      50% { border-color: #34d399; box-shadow: 0 0 0 10px rgba(16, 185, 129, 0); }
      100% { border-color: #10b981; box-shadow: 0 0 0 0 rgba(16, 185, 129, 0); }
    }
    .input-group {
      position: relative;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    .input-group input,
    .input-group select {
      padding: 0.75rem 1rem;
      border: 2px solid rgba(255, 255, 255, 0.2);
      border-radius: 12px;
      transition: all 0.3s ease;
      font-size: 0.95rem;
      width: 100%;
      background: rgba(255, 255, 255, 0.95);
      color: #4a5568;
    }
    .input-group input:focus,
    .input-group select:focus {
      border-color: rgba(102, 126, 234, 0.6);
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.2);
      outline: none;
    }
    .input-group .icon {
      position: absolute;
      right: 1rem;
      color: #6b7280;
      transition: all 0.3s ease;
    }
    .input-group .icon.success {
      color: #10b981;
    }
    .input-group .icon.error {
      color: #dc2626;
    }
    /* Toast Notifications */
    .toast-container {
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 1000;
      display: flex;
      flex-direction: column;
      gap: 10px;
      pointer-events: none;
    }
    .toast {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px 16px;
      border-radius: 8px;
      background: white;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      pointer-events: auto;
      animation: slideInRight 0.3s ease-out;
      max-width: 400px;
      font-weight: 500;
      font-size: 0.9rem;
    }
    .toast i {
      font-size: 1.2rem;
      min-width: 24px;
      text-align: center;
    }
    .toast.success {
      background: linear-gradient(135deg, #10b981 0%, #059669 100%);
      color: white;
      border-left: 4px solid #10b981;
    }
    .toast.success i {
      color: #ffffff;
    }
    .toast.error {
      background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
      color: white;
      border-left: 4px solid #ef4444;
    }
    .toast.error i {
      color: #ffffff;
    }
    .toast.info {
      background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
      color: white;
      border-left: 4px solid #3b82f6;
    }
    .toast.info i {
      color: #ffffff;
    }
    .toast.warning {
      background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
      color: white;
      border-left: 4px solid #f59e0b;
    }
    .toast.warning i {
      color: #ffffff;
    }
    .toast-message {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 4px;
    }
    .toast-title {
      font-weight: 600;
      font-size: 0.95rem;
    }
    .toast-text {
      font-weight: 400;
      font-size: 0.85rem;
      opacity: 0.9;
    }
    .toast-progress {
      position: absolute;
      bottom: 0;
      left: 0;
      height: 3px;
      background: rgba(255, 255, 255, 0.3);
      animation: slideOutRight 3s ease-in forwards;
    }
    .toast.success .toast-progress {
      background: rgba(255, 255, 255, 0.5);
    }
    .toast-counter {
      display: inline-block;
      background: rgba(0, 0, 0, 0.2);
      padding: 2px 8px;
      border-radius: 12px;
      font-size: 0.8rem;
      margin-top: 4px;
    }
    @keyframes slideInRight {
      from {
        transform: translateX(400px);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }
    @keyframes slideOutRight {
      from {
        width: 100%;
      }
      to {
        width: 0%;
      }
    }
    /* Offline Indicator */
    .offline-indicator {
      position: fixed;
      bottom: 20px;
      left: 20px;
      padding: 12px 16px;
      border-radius: 12px;
      background: linear-gradient(135deg, #ef4444, #dc2626);
      color: white;
      font-weight: 600;
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      gap: 4px;
      animation: slideInUp 0.3s ease-out;
      z-index: 999;
      box-shadow: 0 4px 20px rgba(239, 68, 68, 0.4);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.1);
      min-width: 200px;
    }
    .offline-indicator.hidden {
      display: none;
    }
    .offline-indicator i {
      font-size: 1.2rem;
      animation: pulse-icon 1s ease-in-out infinite;
    }
    .offline-indicator #cache-stats {
      opacity: 0.8;
      font-size: 0.7rem;
      font-weight: 400;
      color: rgba(255, 255, 255, 0.9);
    }
    @keyframes slideInUp {
      from {
        transform: translateY(100px);
        opacity: 0;
      }
      to {
        transform: translateY(0);
        opacity: 1;
      }
    }
    @keyframes pulse-icon {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }
    /* Sync Status */
    .sync-status {
      position: fixed;
      top: 80px;
      right: 20px;
      padding: 10px 14px;
      border-radius: 6px;
      background: #3b82f6;
      color: white;
      font-size: 0.85rem;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 8px;
      animation: slideInRight 0.3s ease-out;
      z-index: 998;
    }
    .sync-status.hidden {
      display: none;
    }
    .sync-status i {
      animation: spin 1s linear infinite;
    }
    @media (max-width: 640px) {
      .container {
        padding: 0 1rem;
      }
      .btn-primary {
        font-size: 0.9rem;
        padding: 0.75rem 1.25rem;
      }
      .card {
        padding: 1rem;
      }
      .modal > div {
        width: 95%;
        padding: 1rem;
      }
      #scanner-container {
        max-width: 100%;
      }
      .grid-cols-3 {
        grid-template-columns: 1fr;
      }
      .toast-container {
        top: 10px;
        right: 10px;
      }
      .toast {
        max-width: 280px;
        padding: 10px 12px;
      }
      .offline-indicator {
        left: 10px;
        bottom: 10px;
        font-size: 0.85rem;
      }
      .sync-status {
        right: 10px;
        top: 70px;
      }
    }
  </style>
</head>
<body class="min-h-screen">
  <style>
    .mobile-menu {
      transform: translateX(-100%);
      transition: transform 0.3s ease-in-out;
    }
    .mobile-menu.show {
      transform: translateX(0);
    }
    .menu-backdrop {
      transition: opacity 0.3s ease-in-out;
      opacity: 0;
      pointer-events: none;
    }
    .menu-backdrop.show {
      opacity: 1;
      pointer-events: auto;
    }
  </style>

  <nav class="gradient-header p-4 shadow-md fixed w-full top-0 z-30">
    <div class="max-w-7xl mx-auto flex justify-between items-center">
      <h1 class="text-white text-xl sm:text-2xl font-bold flex items-center gap-2">
        <i class="fas fa-cogs"></i> Sistema ERP
      </h1>

      <!-- Menu Mobile Button -->
      <button id="mobile-menu-button" class="lg:hidden text-white focus:outline-none">
        <i class="fas fa-bars text-2xl"></i>
      </button>

      <!-- Desktop Menu -->
      <div class="hidden lg:flex space-x-6 items-center">
        <a href="/system/dashboard.html" class="nav-link text-white hover:text-gray-200 font-medium">Dashboard</a>
        <a href="/system/index.html" class="nav-link text-white hover:text-gray-200 font-medium">Cadastro</a>
        <a href="/system/clients.html" class="nav-link text-white hover:text-gray-200 font-medium">Clientes</a>
        <a href="/system/stock.html" class="nav-link text-white hover:text-gray-200 font-medium">Estoque</a>
        <a href="/system/barcode.html" class="nav-link text-white hover:text-gray-200 font-medium">Leitor</a>
        <a href="/system/plans.html" class="nav-link text-white hover:text-gray-200 font-medium">Planos</a>
        <a href="/system/installers.html" class="nav-link text-white hover:text-gray-200 font-medium">Instaladores</a>
      </div>
    </div>
  </nav>

  <!-- Mobile Menu Overlay -->
  <div id="menu-backdrop" class="menu-backdrop fixed inset-0 bg-black/50 z-40 lg:hidden"></div>

  <!-- Mobile Menu -->
  <div id="mobile-menu" class="mobile-menu fixed left-0 top-0 h-full w-4/5 max-w-sm bg-white dark:bg-gray-800 z-50 lg:hidden overflow-y-auto">
    <div class="p-4 border-b border-gray-200 dark:border-gray-700">
      <div class="flex items-center justify-between">
        <h2 class="text-xl font-semibold text-gray-800 dark:text-white">Menu</h2>
        <button id="close-menu-button" class="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200">
          <i class="fas fa-times text-2xl"></i>
        </button>
      </div>
    </div>
    <nav class="p-4">
      <ul class="space-y-4">
        <li>
          <a href="/system/dashboard.html" class="flex items-center gap-3 text-gray-700 dark:text-gray-200 hover:text-blue-600 dark:hover:text-blue-400 p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700">
            <i class="fas fa-chart-line w-5"></i>
            <span>Dashboard</span>
          </a>
        </li>
        <li>
          <a href="/system/index.html" class="flex items-center gap-3 text-gray-700 dark:text-gray-200 hover:text-blue-600 dark:hover:text-blue-400 p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700">
            <i class="fas fa-plus-circle w-5"></i>
            <span>Cadastro</span>
          </a>
        </li>
        <li>
          <a href="/system/clients.html" class="flex items-center gap-3 text-gray-700 dark:text-gray-200 hover:text-blue-600 dark:hover:text-blue-400 p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700">
            <i class="fas fa-users w-5"></i>
            <span>Clientes</span>
          </a>
        </li>
        <li>
          <a href="/system/stock.html" class="flex items-center gap-3 text-gray-700 dark:text-gray-200 hover:text-blue-600 dark:hover:text-blue-400 p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700">
            <i class="fas fa-box w-5"></i>
            <span>Estoque</span>
          </a>
        </li>
        <li>
          <a href="/system/barcode.html" class="flex items-center gap-3 text-gray-700 dark:text-gray-200 hover:text-blue-600 dark:hover:text-blue-400 p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700">
            <i class="fas fa-barcode w-5"></i>
            <span>Leitor</span>
          </a>
        </li>
        <li>
          <a href="/system/plans.html" class="flex items-center gap-3 text-gray-700 dark:text-gray-200 hover:text-blue-600 dark:hover:text-blue-400 p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700">
            <i class="fas fa-list-alt w-5"></i>
            <span>Planos</span>
          </a>
        </li>
        <li>
          <a href="/system/installers.html" class="flex items-center gap-3 text-gray-700 dark:text-gray-200 hover:text-blue-600 dark:hover:text-blue-400 p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700">
            <i class="fas fa-hard-hat w-5"></i>
            <span>Instaladores</span>
          </a>
        </li>
      </ul>
    </nav>
  </div>

  <div class="mt-20 max-w-7xl mx-auto p-4 sm:p-6 container">
    <h2 class="text-2xl sm:text-3xl font-bold text-white mb-6 text-center flex items-center justify-center gap-3">
      <i class="fas fa-barcode text-white/90"></i> Leitor de CÃ³digos de Equipamento
    </h2>

    <!-- Leitor de CÃ³digos -->
    <div class="card p-6 mb-6">
      <h3 class="text-lg font-semibold text-gray-800 mb-4">Escanear ou Digitar CÃ³digo de Equipamento</h3>
      <div id="scanner-container" class="mb-4">
        <video id="scanner-video" autoplay playsinline></video>
        <div id="scanner-overlay"></div>
      </div>
      <p id="scanner-status" class="text-center text-gray-600 mb-4">Aguardando leitura...</p>
      <div class="flex flex-col sm:flex-row gap-4 mb-4">
        <button id="start-scanner-btn" onclick="startScanner()" class="btn-primary bg-blue-600 text-white p-3 rounded-lg hover:bg-blue-700 w-full sm:w-auto">
          <i class="fas fa-camera"></i> Iniciar Scanner
        </button>
        <button id="stop-scanner-btn" onclick="stopScanner()" class="btn-primary bg-red-600 text-white p-3 rounded-lg hover:bg-red-700 w-full sm:w-auto hidden">
          <i class="fas fa-stop"></i> Parar Scanner
        </button>
      </div>
      <div class="input-group mb-4">
        <input type="text" id="manual-barcode" placeholder="Digite o cÃ³digo de barras" class="p-3 border rounded-lg focus:outline-none w-full" aria-label="CÃ³digo de barras manual">
        <button onclick="processManualCode()" class="btn-primary bg-green-600 text-white p-3 rounded-lg hover:bg-green-700 ml-2">
          <i class="fas fa-check"></i> Processar
        </button>
      </div>
      <div id="scannedItemInfo" class="mt-4 hidden bg-white/95 p-6 rounded-2xl border border-white/20 shadow-lg backdrop-blur-md">
        <div class="flex items-center gap-3 mb-4">
          <div class="bg-gradient-to-r from-purple-500 to-indigo-500 p-3 rounded-lg">
            <i class="fas fa-box text-white text-xl"></i>
          </div>
          <div>
            <h4 class="text-lg font-semibold text-gray-800">Equipamento Escaneado</h4>
            <p class="text-sm text-gray-600">Detalhes do item identificado</p>
          </div>
        </div>
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-4">
          <div class="bg-white p-3 rounded-lg border border-gray-100">
            <p class="text-sm text-gray-500">Nome do Equipamento</p>
            <p class="font-medium text-gray-800" id="scannedItemName"></p>
          </div>
          <div class="bg-white p-3 rounded-lg border border-gray-100">
            <p class="text-sm text-gray-500">CÃ³digo de Barras</p>
            <p class="font-medium text-gray-800" id="scannedItemBarcode"></p>
          </div>
        </div>
        <form id="scannedMovementForm" class="grid grid-cols-1 sm:grid-cols-3 gap-4 mt-4">
          <div class="input-group">
            <input type="text" id="clientCpf" placeholder="CPF do Cliente (ex: 12345678900)" class="p-3 border rounded-lg focus:outline-none" required aria-label="CPF do cliente">
            <i id="cpf-icon" class="fas fa-circle-notch fa-spin icon hidden"></i>
          </div>
          <p id="clientName" class="text-gray-600"></p>
          <select id="scannedInstaller" class="p-3 border rounded-lg focus:outline-none" required aria-label="Instalador">
            <option value="">Selecione o Instalador</option>
          </select>
          <select id="scannedMovementType" class="p-3 border rounded-lg focus:outline-none" required aria-label="Tipo de movimentaÃ§Ã£o">
            <option value="">Tipo de MovimentaÃ§Ã£o</option>
            <option value="entry">Entrada</option>
            <option value="exit">SaÃ­da</option>
          </select>
          <input type="number" id="scannedQuantity" placeholder="Quantidade" class="p-3 border rounded-lg focus:outline-none" required min="1" aria-label="Quantidade">
          <input type="hidden" id="scannedItemId">
          <button type="submit" class="btn-primary bg-blue-600 text-white p-3 rounded-lg hover:bg-blue-700 col-span-1 sm:col-span-3">
            <i class="fas fa-exchange-alt"></i> Registrar MovimentaÃ§Ã£o
          </button>
        </form>
      </div>
    </div>
  </div>

  <div id="modal" class="modal fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden">
    <div class="bg-white p-6 rounded-lg shadow-xl max-w-md w-full sm:w-3/4">
      <h3 id="modalTitle" class="text-lg font-semibold text-gray-800 mb-4 flex items-center gap-2"></h3>
      <p id="modalMessage" class="text-gray-600 mb-6"></p>
      <div class="flex flex-col sm:flex-row gap-4">
        <button onclick="closeModal()" class="btn-primary bg-blue-600 text-white p-2 rounded-lg hover:bg-blue-700 flex-1">
          <i class="fas fa-check"></i> OK
        </button>
        <button id="retry-btn" onclick="retryAction()" class="btn-primary bg-gray-600 text-white p-2 rounded-lg hover:bg-gray-700 flex-1 hidden">
          <i class="fas fa-redo"></i> Tentar Novamente
        </button>
      </div>
    </div>
  </div>

  <!-- Toast Container -->
  <div id="toast-container" class="toast-container"></div>

  <!-- Offline Indicator -->
  <div id="offline-indicator" class="offline-indicator hidden">
    <i class="fas fa-wifi-slash"></i>
    <span>Modo Offline</span>
    <div id="cache-stats" class="text-xs mt-1">Cache carregando...</div>
  </div>

  <!-- Sync Status -->
  <div id="sync-status" class="sync-status hidden">
    <i class="fas fa-sync"></i>
    <span>Sincronizando...</span>
  </div>

  <script>
    // ============ TOAST NOTIFICATIONS ============
    let toastCount = 0;
    
    function showToast(title, message = '', type = 'info', duration = 3000) {
      toastCount++;
      const toastId = `toast-${Date.now()}-${toastCount}`;
      
      const container = document.getElementById('toast-container');
      const toast = document.createElement('div');
      toast.id = toastId;
      toast.className = `toast ${type} relative overflow-hidden`;
      
      let icon = 'fas fa-info-circle';
      if (type === 'success') icon = 'fas fa-check-circle';
      else if (type === 'error') icon = 'fas fa-exclamation-circle';
      else if (type === 'warning') icon = 'fas fa-exclamation-triangle';
      
      toast.innerHTML = `
        <i class="${icon}"></i>
        <div class="toast-message">
          <div class="toast-title">${title}</div>
          ${message ? `<div class="toast-text">${message}</div>` : ''}
        </div>
        <div class="toast-progress"></div>
      `;
      
      container.appendChild(toast);
      
      // Auto-remove apÃ³s duration
      setTimeout(() => {
        toast.style.animation = 'slideOutRight 0.3s ease-out forwards';
        setTimeout(() => {
          if (toast.parentNode) toast.parentNode.removeChild(toast);
          toastCount--;
        }, 300);
      }, duration);
      
      return toastId;
    }

    // ============ OFFLINE & SYNC ============
    let isOffline = false;
    let pendingMoves = [];
    let cachedItems = new Map();
    let cachedInstallers = [];
    const dbName = 'barcodeDB';
    const storeName = 'pendingMoves';
    const itemsStoreName = 'cachedItems';
    const installersStoreName = 'cachedInstallers';

    // Detectar status online/offline
    window.addEventListener('online', () => {
      isOffline = false;
      document.getElementById('offline-indicator').classList.add('hidden');
      showToast('Conectado', 'ConexÃ£o restaurada', 'success', 2000);
      
      // Tentar recarregar dados mais recentes
      loadFilters();
      preloadItemsCache();
      syncOfflineQueue();
    });

    window.addEventListener('offline', () => {
      isOffline = true;
      document.getElementById('offline-indicator').classList.remove('hidden');
      showToast('Desconectado', 'Modo offline ativado - dados em cache serÃ£o usados', 'warning', 4000);
      updateCacheStats();
    });

    // Abrir IndexedDB
    function openDB() {
      return new Promise((resolve, reject) => {
        const request = indexedDB.open(dbName, 2);
        
        request.onerror = () => reject(request.error);
        request.onsuccess = () => resolve(request.result);
        
        request.onupgradeneeded = (event) => {
          const db = event.target.result;
          
          // Store para movimentaÃ§Ãµes pendentes
          if (!db.objectStoreNames.contains(storeName)) {
            db.createObjectStore(storeName, { keyPath: 'id', autoIncrement: true });
          }
          
          // Store para cache de itens
          if (!db.objectStoreNames.contains(itemsStoreName)) {
            const itemsStore = db.createObjectStore(itemsStoreName, { keyPath: 'barcode' });
            itemsStore.createIndex('name', 'name', { unique: false });
          }
          
          // Store para cache de instaladores
          if (!db.objectStoreNames.contains(installersStoreName)) {
            db.createObjectStore(installersStoreName, { keyPath: 'id' });
          }
        };
      });
    }

    // Cache de itens para uso offline
    async function preloadItemsCache() {
      try {
        const response = await fetch('/system/api/stock.php?action=get_all_items');
        if (response.ok) {
          const items = await response.json();
          const db = await openDB();
          const tx = db.transaction(itemsStoreName, 'readwrite');
          const store = tx.objectStore(itemsStoreName);
          
          // Limpar cache antigo
          store.clear();
          
          // Adicionar novos itens
          for (const item of items) {
            store.put({
              ...item,
              cached_at: new Date().toISOString()
            });
            cachedItems.set(item.barcode, item);
          }
          
          console.log(`[CACHE] ${items.length} itens salvos no cache`);
          showToast('Cache Atualizado', `${items.length} equipamentos em cache`, 'info', 2000);
        }
      } catch (error) {
        console.log('[CACHE] Erro ao carregar itens para cache:', error);
      }
    }

    // Cache de instaladores para uso offline
    async function cacheInstallers(installers) {
      try {
        const db = await openDB();
        const tx = db.transaction(installersStoreName, 'readwrite');
        const store = tx.objectStore(installersStoreName);
        
        // Limpar cache antigo
        store.clear();
        
        // Adicionar novos instaladores
        for (const installer of installers) {
          store.put({
            ...installer,
            cached_at: new Date().toISOString()
          });
        }
        
        cachedInstallers = installers;
        console.log(`[CACHE] ${installers.length} instaladores salvos no cache`);
      } catch (error) {
        console.log('[CACHE] Erro ao cachear instaladores:', error);
      }
    }

    // Buscar item por cÃ³digo de barras (online/offline)
    async function getItemByBarcode(barcode) {
      try {
        if (!isOffline) {
          // Tentar online primeiro
          const response = await fetch(`/system/api/stock.php?action=get_item_by_barcode&barcode=${encodeURIComponent(barcode)}`);
          if (response.ok) {
            const item = await response.json();
            // Atualizar cache local
            cachedItems.set(barcode, item);
            return item;
          }
        }
        
        // Fallback para cache
        if (cachedItems.has(barcode)) {
          showToast('Cache', 'Usando dados offline', 'info', 1500);
          return cachedItems.get(barcode);
        }
        
        // Buscar no IndexedDB
        const db = await openDB();
        const tx = db.transaction(itemsStoreName, 'readonly');
        const store = tx.objectStore(itemsStoreName);
        
        return new Promise((resolve, reject) => {
          const request = store.get(barcode);
          request.onsuccess = () => {
            if (request.result) {
              showToast('Cache', 'Equipamento encontrado offline', 'info', 2000);
              resolve(request.result);
            } else {
              reject(new Error('Equipamento nÃ£o encontrado no cache offline'));
            }
          };
          request.onerror = () => reject(request.error);
        });
        
      } catch (error) {
        throw new Error(`Equipamento nÃ£o encontrado: ${error.message}`);
      }
    }

    // Carregar instaladores do cache se offline
    async function loadInstallersFromCache() {
      try {
        const db = await openDB();
        const tx = db.transaction(installersStoreName, 'readonly');
        const store = tx.objectStore(installersStoreName);
        
        return new Promise((resolve, reject) => {
          const request = store.getAll();
          request.onsuccess = () => {
            const installers = request.result;
            if (installers.length > 0) {
              showToast('Cache', `${installers.length} instaladores carregados offline`, 'info', 2000);
              resolve(installers);
            } else {
              reject(new Error('Nenhum instalador em cache'));
            }
          };
          request.onerror = () => reject(request.error);
        });
      } catch (error) {
        throw error;
      }
    }

    // Salvar movimentaÃ§Ã£o offline
    async function savePendingMove(moveData) {
      try {
        const db = await openDB();
        const tx = db.transaction(storeName, 'readwrite');
        const store = tx.objectStore(storeName);
        const request = store.add({
          ...moveData,
          timestamp: new Date().toISOString(),
          synced: false
        });
        
        return new Promise((resolve, reject) => {
          request.onsuccess = () => {
            pendingMoves.push(moveData);
            showToast('Armazenado Offline', 'SerÃ¡ sincronizado quando conectado', 'info', 2000);
            updateCacheStats(); // Atualizar estatÃ­sticas
            resolve(request.result);
          };
          request.onerror = () => reject(request.error);
        });
      } catch (error) {
        console.error('Erro ao salvar offline:', error);
        showToast('Erro', 'Falha ao salvar movimento offline', 'error');
        throw error;
      }
    }

    // Sincronizar fila offline
    async function syncOfflineQueue() {
      try {
        const db = await openDB();
        const tx = db.transaction(storeName, 'readonly');
        const store = tx.objectStore(storeName);
        const request = store.getAll();
        
        return new Promise((resolve, reject) => {
          request.onsuccess = async () => {
            const moves = request.result;
            
            if (moves.length === 0) {
              resolve();
              return;
            }
            
            document.getElementById('sync-status').classList.remove('hidden');
            showToast('Sincronizando', `${moves.length} movimentaÃ§Ã£o(Ãµes) pendente(s)`, 'info', 2000);
            
            let synced = 0;
            let failed = 0;
            
            for (const move of moves) {
              try {
                const response = await fetch('/system/api/stock.php?action=add_movement', {
                  method: 'POST',
                  headers: { 'Content-Type': 'application/json' },
                  body: JSON.stringify(move)
                });
                
                if (response.ok) {
                  // Remover da fila
                  const deleteTx = db.transaction(storeName, 'readwrite');
                  deleteTx.objectStore(storeName).delete(move.id);
                  synced++;
                } else {
                  failed++;
                }
              } catch (error) {
                console.log('Erro ao sincronizar:', error);
                failed++;
              }
            }
            
            document.getElementById('sync-status').classList.add('hidden');
            
            if (synced > 0) {
              showToast('Sincronizado', `${synced} movimentaÃ§Ã£o(Ãµes) enviada(s)`, 'success', 3000);
            }
            if (failed > 0) {
              showToast('Aviso', `${failed} movimentaÃ§Ã£o(Ãµes) falharam`, 'warning', 3000);
            }
            
            updateCacheStats(); // Atualizar estatÃ­sticas apÃ³s sincronizaÃ§Ã£o
            resolve();
          };
          request.onerror = () => reject(request.error);
        });
      } catch (error) {
        console.error('Erro ao sincronizar fila:', error);
        document.getElementById('sync-status').classList.add('hidden');
        showToast('Erro', 'Falha ao sincronizar. Tentando novamente...', 'error');
      }
    }

    // Registrar Service Worker
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/system/service-worker.js')
          .then(registration => {
            console.log('[APP] Service Worker registrado:', registration);
            
            // Ouvir mensagens do Service Worker
            navigator.serviceWorker.addEventListener('message', event => {
              if (event.data.type === 'SYNC_COMPLETE') {
                console.log('[APP] SincronizaÃ§Ã£o completa:', event.data.synced);
                showToast('SincronizaÃ§Ã£o Completa', `${event.data.synced} item(ns) sincronizado(s)`, 'success', 3000);
              }
            });
          })
          .catch(error => {
            console.log('[APP] Erro ao registrar Service Worker:', error);
          });
      });
    }

    // ============ BARCODE FUNCTIONS ============
    (function ensureGetUserMediaCompat(){
      if (typeof navigator === 'undefined') return;
      if (!navigator.mediaDevices) navigator.mediaDevices = {};
      if (!navigator.mediaDevices.getUserMedia) {
        const legacy = navigator.getUserMedia || navigator.webkitGetUserMedia || navigator.mozGetUserMedia || navigator.msGetUserMedia;
        if (legacy) {
          navigator.mediaDevices.getUserMedia = function(constraints){
            return new Promise((resolve, reject)=> legacy.call(navigator, constraints, resolve, reject));
          };
        }
      }
    })();

    async function getUserMediaCompat(constraints){
      // Checagem de contexto seguro (HTTPS/localhost) exigido pela API
      const isSecure = location.protocol === 'https:' || location.hostname === 'localhost' || location.hostname === '127.0.0.1';
      if (!isSecure) {
        throw new Error('A cÃ¢mera requer HTTPS ou localhost. Acesse via https:// ou use localhost.');
      }
      if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
        throw new Error('getUserMedia nÃ£o Ã© suportado neste navegador. Atualize o navegador ou use Chrome/Firefox/Safari modernos.');
      }
      return navigator.mediaDevices.getUserMedia(constraints);
    }

    let scannerActive = false;
    let video = document.getElementById('scanner-video');
    let stream = null;
    let retryActionCallback = null;

    function showModal(title, message, iconClass = 'fas fa-info-circle text-blue-600', showRetry = false) {
      document.getElementById('modalTitle').innerHTML = `<i class="${iconClass}"></i> ${title}`;
      document.getElementById('modalMessage').textContent = message;
      const modal = document.getElementById('modal');
      const retryBtn = document.getElementById('retry-btn');
      retryBtn.classList.toggle('hidden', !showRetry);
      modal.classList.remove('hidden');
      modal.classList.add('show');
      setTimeout(() => modal.classList.add('show'), 10);
    }

    function closeModal() {
      const modal = document.getElementById('modal');
      modal.classList.remove('show');
      setTimeout(() => modal.classList.add('hidden'), 300);
      retryActionCallback = null;
    }

    function retryAction() {
      if (retryActionCallback) retryActionCallback();
      closeModal();
    }

    function updateScannerStatus(message, color = 'text-gray-600') {
      const status = document.getElementById('scanner-status');
      status.textContent = message;
      status.className = `text-center ${color}`;
    }

    async function loadFilters() {
      try {
        let installers = [];
        
        if (!isOffline) {
          // Tentar carregar online
          const response = await fetch('/system/api/installers.php');
          if (response.ok) {
            installers = await response.json();
            // Cachear para uso offline
            await cacheInstallers(installers);
          } else {
            throw new Error(`Erro ao carregar instaladores: ${response.statusText}`);
          }
        } else {
          // Carregar do cache
          installers = await loadInstallersFromCache();
        }
        
        const installerSelect = document.getElementById('scannedInstaller');
        // Limpar opÃ§Ãµes existentes (exceto a primeira)
        installerSelect.innerHTML = '<option value="">Selecione um Instalador</option>';
        
        installers.forEach(installer => {
          const option = document.createElement('option');
          option.value = installer.name;
          option.textContent = installer.name;
          installerSelect.appendChild(option);
        });
        
        if (isOffline) {
          showToast('Cache', 'Instaladores carregados do cache offline', 'info', 2000);
        }
        
      } catch (error) {
        console.error('Erro ao carregar instaladores:', error);
        showToast('â Erro', `Erro ao carregar instaladores: ${error.message}`, 'error', 3000);
        
        if (!isOffline) {
          showModal('Erro', `Erro ao carregar instaladores: ${error.message}`, 'fas fa-exclamation-triangle text-red-600');
        }
      }
    }

    async function startScanner() {
      if (scannerActive) return;
      try {
        stream = await getUserMediaCompat({ video: { facingMode: 'environment' } });
        video.srcObject = stream;
        scannerActive = true;
        updateScannerStatus('Escaneando...', 'text-blue-600');
        document.getElementById('start-scanner-btn').classList.add('btn-scanning', 'hidden');
        document.getElementById('stop-scanner-btn').classList.remove('hidden');

        Quagga.init({
          inputStream: {
            name: 'Live',
            type: 'LiveStream',
            target: document.getElementById('scanner-video'),
            constraints: { facingMode: 'environment' }
          },
          decoder: {
            readers: ['ean_reader', 'code_128_reader', 'upc_reader']
          }
        }, function(err) {
          if (err) {
            updateScannerStatus('Erro ao iniciar scanner', 'text-red-600');
            showModal('Erro', `Erro ao iniciar scanner: ${err.message}`, 'fas fa-exclamation-triangle text-red-600', true);
            retryActionCallback = startScanner;
            stopScanner();
            return;
          }
          Quagga.start();
        });

        Quagga.onDetected(async (data) => {
          const code = data.codeResult.code;
          updateScannerStatus('CÃ³digo detectado!', 'text-green-600');
          Quagga.stop();
          stopScanner();
          await processCode(code);
        });

        const canvas = document.createElement('canvas');
        const ctx = canvas.getContext('2d');
        const scanQR = () => {
          if (!scannerActive) return;
          canvas.width = video.videoWidth;
          canvas.height = video.videoHeight;
          ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
          const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
          const code = jsQR(imageData.data, imageData.width, imageData.height);
          if (code) {
            updateScannerStatus('CÃ³digo QR detectado!', 'text-green-600');
            stopScanner();
            processCode(code.data);
          } else {
            requestAnimationFrame(scanQR);
          }
        };
        requestAnimationFrame(scanQR);
      } catch (error) {
        updateScannerStatus('Erro ao acessar cÃ¢mera', 'text-red-600');
        const hint = (error && typeof error.message === 'string' && error.message.includes('HTTPS'))
          ? '\nDica: abra o sistema em https:// (ou localhost) para liberar a cÃ¢mera.'
          : '';
        showModal('Erro', `Erro ao acessar cÃ¢mera: ${error.message}${hint}`, 'fas fa-exclamation-triangle text-red-600', true);
        retryActionCallback = startScanner;
        stopScanner();
      }
    }

    function stopScanner() {
      if (stream) {
        stream.getTracks().forEach(track => track.stop());
        video.srcObject = null;
        stream = null;
      }
      if (Quagga) Quagga.stop();
      scannerActive = false;
      updateScannerStatus('Aguardando leitura...', 'text-gray-600');
      document.getElementById('start-scanner-btn').classList.remove('btn-scanning', 'hidden');
      document.getElementById('stop-scanner-btn').classList.add('hidden');
    }

    async function processCode(code) {
      try {
        // Usar funÃ§Ã£o com cache offline
        const item = await getItemByBarcode(code);
        
        if (item.error) {
          throw new Error(item.error);
        }
        document.getElementById('scannedItemName').textContent = item.name;
        document.getElementById('scannedItemBarcode').textContent = item.barcode;
        document.getElementById('scannedItemId').value = item.id;
        document.getElementById('scannedItemInfo').classList.remove('hidden');
        
        // Status visual de sucesso
        const statusMsg = isOffline ? 'Equipamento encontrado (cache offline)' : 'Equipamento encontrado';
        showToast('â Equipamento Encontrado', `${item.name} (${item.barcode})`, 'success', 2000);
      } catch (error) {
        showToast('â Erro', `Equipamento nÃ£o encontrado: ${error.message}`, 'error', 3000);
        showModal('Erro', `Equipamento nÃ£o encontrado: ${error.message}`, 'fas fa-exclamation-triangle text-red-600', true);
        retryActionCallback = startScanner;
      }
    }

    async function processManualCode() {
      const code = document.getElementById('manual-barcode').value.trim();
      if (!code) {
        showToast('â Erro', 'Digite um cÃ³digo de barras', 'error', 2000);
        return;
      }
      await processCode(code);
      document.getElementById('manual-barcode').value = '';
    }

    async function validateClientCpf(cpf) {
      const cpfIcon = document.getElementById('cpf-icon');
      cpfIcon.classList.remove('fa-check', 'fa-times', 'success', 'error');
      cpfIcon.classList.add('fa-circle-notch', 'fa-spin');

      try {
        // Normalizar CPF no frontend
        const normalizedCpf = cpf.replace(/[\.\-]/g, '');
        if (!/^\d{11}$/.test(normalizedCpf)) {
          throw new Error('CPF invÃ¡lido. Deve conter 11 dÃ­gitos.');
        }
        const response = await fetch(`/system/api/stock.php?action=get_client_by_cpf&cpf=${encodeURIComponent(normalizedCpf)}`);
        if (!response.ok) {
          const errorText = await response.text();
          throw new Error(`Erro HTTP ${response.status}: ${errorText || response.statusText}`);
        }
        const client = await response.json();
        if (client.error) {
          throw new Error(client.error);
        }
        document.getElementById('clientName').textContent = `Cliente: ${client.name}`;
        cpfIcon.classList.remove('fa-circle-notch', 'fa-spin');
        cpfIcon.classList.add('fa-check', 'success');
        return normalizedCpf;
      } catch (error) {
        document.getElementById('clientName').textContent = '';
        cpfIcon.classList.remove('fa-circle-notch', 'fa-spin');
        cpfIcon.classList.add('fa-times', 'error');
        showModal('Erro', `Cliente nÃ£o encontrado: ${error.message}`, 'fas fa-exclamation-triangle text-red-600');
        return false;
      }
    }

    document.getElementById('clientCpf').addEventListener('blur', async (e) => {
      const cpf = e.target.value.trim();
      if (cpf) {
        await validateClientCpf(cpf);
      } else {
        document.getElementById('clientName').textContent = '';
        document.getElementById('cpf-icon').classList.add('hidden');
      }
    });

    document.getElementById('scannedMovementForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const itemId = document.getElementById('scannedItemId').value;
      const installer = document.getElementById('scannedInstaller').value;
      const type = document.getElementById('scannedMovementType').value;
      const quantity = document.getElementById('scannedQuantity').value;
      const clientCpf = document.getElementById('clientCpf').value.trim();

      if (!clientCpf) {
        showToast('â Erro', 'Por favor, insira o CPF do cliente', 'error', 2000);
        return;
      }

      const normalizedCpf = await validateClientCpf(clientCpf);
      if (!normalizedCpf) return;

      const moveData = {
        item_id: itemId,
        installer,
        type,
        quantity,
        client_id: normalizedCpf
      };

      try {
        if (isOffline) {
          // Modo offline - salvar localmente
          await savePendingMove(moveData);
          document.getElementById('scannedMovementForm').reset();
          document.getElementById('scannedItemInfo').classList.add('hidden');
          document.getElementById('clientName').textContent = '';
          document.getElementById('cpf-icon').classList.add('hidden');
          return;
        }

        const response = await fetch('/system/api/stock.php?action=add_movement', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(moveData)
        });
        
        if (!response.ok) {
          const errorText = await response.text();
          throw new Error(`Erro HTTP ${response.status}: ${errorText || response.statusText}`);
        }
        
        const result = await response.json();
        if (result.error) {
          throw new Error(result.error);
        }
        
        showToast('â Sucesso', 'MovimentaÃ§Ã£o registrada com sucesso!', 'success', 2000);
        
        // Auto-limpar formulÃ¡rio
        setTimeout(() => {
          document.getElementById('scannedMovementForm').reset();
          document.getElementById('scannedItemInfo').classList.add('hidden');
          document.getElementById('clientName').textContent = '';
          document.getElementById('cpf-icon').classList.add('hidden');
        }, 500);
        
      } catch (error) {
        if (isOffline) {
          // Se offline, salvar mesmo assim
          await savePendingMove(moveData);
          document.getElementById('scannedMovementForm').reset();
          document.getElementById('scannedItemInfo').classList.add('hidden');
          document.getElementById('clientName').textContent = '';
          document.getElementById('cpf-icon').classList.add('hidden');
        } else {
          showToast('â Erro', `Falha ao registrar: ${error.message}`, 'error', 3000);
        }
      }
    });

    window.onload = function() {
      loadFilters();
      initMobileMenu();
      initOfflineCache();
    };

    // Inicializar cache offline
    async function initOfflineCache() {
      try {
        await preloadItemsCache();
        updateCacheStats();
      } catch (error) {
        console.log('[CACHE] Erro ao inicializar cache:', error);
      }
    }

    // Atualizar estatÃ­sticas de cache
    async function updateCacheStats() {
      try {
        const db = await openDB();
        
        // Contar itens em cache
        const itemsTx = db.transaction(itemsStoreName, 'readonly');
        const itemsStore = itemsTx.objectStore(itemsStoreName);
        const itemsCount = await new Promise((resolve, reject) => {
          const request = itemsStore.count();
          request.onsuccess = () => resolve(request.result);
          request.onerror = () => reject(request.error);
        });
        
        // Contar instaladores em cache
        const installersTx = db.transaction(installersStoreName, 'readonly');
        const installersStore = installersTx.objectStore(installersStoreName);
        const installersCount = await new Promise((resolve, reject) => {
          const request = installersStore.count();
          request.onsuccess = () => resolve(request.result);
          request.onerror = () => reject(request.error);
        });
        
        // Contar movimentaÃ§Ãµes pendentes
        const movesTx = db.transaction(storeName, 'readonly');
        const movesStore = movesTx.objectStore(storeName);
        const pendingCount = await new Promise((resolve, reject) => {
          const request = movesStore.count();
          request.onsuccess = () => resolve(request.result);
          request.onerror = () => reject(request.error);
        });
        
        const cacheStatsEl = document.getElementById('cache-stats');
        if (cacheStatsEl) {
          cacheStatsEl.textContent = `${itemsCount} itens â¢ ${installersCount} instaladores â¢ ${pendingCount} pendentes`;
        }
        
      } catch (error) {
        console.log('[CACHE] Erro ao atualizar estatÃ­sticas:', error);
      }
    }

    // FunÃ§Ã£o para limpar cache manualmente (adicionar botÃ£o se necessÃ¡rio)
    async function clearOfflineCache() {
      try {
        const db = await openDB();
        
        // Limpar apenas cache, manter movimentaÃ§Ãµes pendentes
        const itemsTx = db.transaction(itemsStoreName, 'readwrite');
        itemsTx.objectStore(itemsStoreName).clear();
        
        const installersTx = db.transaction(installersStoreName, 'readwrite');
        installersTx.objectStore(installersStoreName).clear();
        
        cachedItems.clear();
        cachedInstallers = [];
        
        showToast('Cache Limpo', 'Cache offline foi limpo com sucesso', 'success', 2000);
        updateCacheStats();
        
      } catch (error) {
        console.error('[CACHE] Erro ao limpar cache:', error);
        showToast('Erro', 'Erro ao limpar cache offline', 'error', 2000);
      }
    }

    function initMobileMenu() {
      const mobileMenuButton = document.getElementById('mobile-menu-button');
      const closeMenuButton = document.getElementById('close-menu-button');
      const mobileMenu = document.getElementById('mobile-menu');
      const menuBackdrop = document.getElementById('menu-backdrop');

      function openMenu() {
        mobileMenu.classList.add('show');
        menuBackdrop.classList.add('show');
        document.body.style.overflow = 'hidden';
      }

      function closeMenu() {
        mobileMenu.classList.remove('show');
        menuBackdrop.classList.remove('show');
        document.body.style.overflow = '';
      }

      mobileMenuButton.addEventListener('click', openMenu);
      closeMenuButton.addEventListener('click', closeMenu);
      menuBackdrop.addEventListener('click', closeMenu);

      // Fechar menu ao clicar em um link
      const mobileMenuLinks = mobileMenu.getElementsByTagName('a');
      Array.from(mobileMenuLinks).forEach(link => {
        link.addEventListener('click', closeMenu);
      });

      // Fechar menu ao redimensionar para desktop
      window.addEventListener('resize', () => {
        if (window.innerWidth >= 1024) { // 1024px Ã© o breakpoint lg do Tailwind
          closeMenu();
        }
      });
    }
  </script>
</body>
</html>